# AI教案创建系统重构设计

## 问题分析

### 当前存在的问题

#### 1. UI层级遮挡问题
**问题描述**：在教案创建完成页面，导出Word和导出PPT按钮被遮挡或布局不当，导致用户无法正常使用导出功能。

**影响范围**：
- 用户无法导出生成的教案
- 严重影响核心功能的可用性

#### 2. PPT生成流程不符合预期
**问题描述**：当前系统直接导出PPT，但用户期望的流程是：
1. 首先生成PPT大纲（可预览和编辑）
2. 然后基于大纲一键生成AI PPT

**当前流程缺陷**：
- 缺少大纲预览和确认环节
- 用户无法在生成前调整PPT内容结构
- 与参考示例（超星等平台）的体验差距大

#### 3. 教案创建方式单一
**问题描述**：当前仅支持基于知识点创建教案，但实际需求包含多种创建方式：
- 标题创建：输入课程名自动生成
- 文本创建：基于教材章节段落生成
- 章节创建：针对特定章节创建
- 知识点创建：当前已有方式
- 大纲创建：基于目录结构生成（当前缺失）

**根本问题**：系统将"知识点"和"大纲/目录"混为一谈，未能区分两种不同的内容组织形式。

#### 4. 缺少参数配置和模板管理
**问题描述**：系统缺少完整的教案生成配置体系：
- 学生学段选择（本科/高职/初中/高中等）
- 教授学科选择
- 文笔语气选择（严谨/通俗/细腻）
- 语言选择（简体中文/英文等）
- 教案模块选择（学情分析、教学目标、课程重点、教学准备等）
- Word教案模板选择（标准教案、课程表形式、图文结构、双栏排版、简洁型等）
- 参考教案上传功能

**影响**：AI生成的教案缺乏个性化和场景适配性。

#### 5. 知识点选择交互问题
**问题描述**：选择目录后，无法自动选中该目录下的所有知识点。

**期望行为**：点击目录节点，自动联动选中其下所有子知识点。

#### 6. 模板管理功能缺失
**问题描述**：教案模板应当作为可管理的资源文件，支持：
- 上传自定义模板
- 管理现有模板
- 选择和应用模板

**当前状态**：模板功能未实现或未提供管理入口。

## 设计目标

### 核心目标
1. 修复导出按钮UI遮挡问题，确保功能可用
2. 实现"生成PPT大纲 → 预览确认 → 生成AI PPT"完整流程
3. 支持多种教案创建入口（标题、文本、章节、知识点、大纲）
4. 提供完整的AI生成参数配置体系
5. 实现目录与知识点的联动选择
6. 建立教案模板管理系统

### 用户体验目标
- 清晰的操作流程，每一步都有明确反馈
- 灵活的创建方式，满足不同场景需求
- 可预览、可编辑的中间结果
- 丰富的自定义配置选项
- 简洁直观的模板管理

## 功能设计

### 一、教案创建页面重构

#### 1.1 顶部创建方式入口

##### 入口设计
提供5种创建方式，以标签页或大卡片形式展示：

| 创建方式 | 用户输入 | AI行为 | 使用场景 |
|---------|---------|--------|---------|
| 标题创建 | 课程名称 | 自动生成整套教案 | 快速创建标准教案 |
| 文本创建 | 教材章节文字 | 按模板转换为教案 | 基于现有教材内容 |
| 章节创建 | 章节号和名称 | 生成特定章节教案 | 单节课备课 |
| 知识点创建 | 选择知识点 | 围绕知识点生成 | 知识点专题教学 |
| 大纲创建 | 输入/导入目录结构 | 按大纲层级生成 | 系统化课程设计 |

##### 交互流程
1. 用户选择创建方式
2. 系统展示对应输入界面
3. 用户填写必要信息
4. 进入参数配置环节

##### 大纲创建特别说明
**大纲结构定义**：
- 大纲是课程的目录树结构（章、节、小节）
- 知识点是具体的教学内容单元
- 大纲可以包含多个知识点，但知识点不等于大纲

**大纲输入方式**：
- 手动输入：逐级添加章节标题
- 导入文本：粘贴Markdown或纯文本格式的大纲
- 上传文件：支持.txt、.md、.docx格式

**大纲示例格式**：
```
第一章 波粒二象性
  1.1 光的波粒二象性
    1.1.1 光的波动性
    1.1.2 光的粒子性
  1.2 德布罗意假设
    1.2.1 假设内容
    1.2.2 公式推导
  1.3 实验验证
```

#### 1.2 基本参数配置区

##### 学生学段
提供选择器，选项包括：
- 小学
- 初中
- 高中
- 本科
- 高职/专科
- 研究生
- 自定义

##### 教授学科
提供选择器，内置常见学科：
- 计算机科学
- 数学
- 物理
- 化学
- 生物
- 经济学
- 统计学
- 工程类
- 人文社科
- 自定义输入

##### 文笔语气
提供单选按钮：
- 严谨学术：适合高等教育和专业课程
- 通俗易懂：适合基础教育和科普
- 细腻生动：适合人文和艺术类课程
- 简洁高效：适合实践和实验课程

##### 语言选择
提供下拉选择：
- 简体中文
- 繁体中文
- 英文
- 双语（中英对照）

**参数影响说明**：
- 学段决定知识深度和表达方式
- 学科决定专业术语和教学方法
- 语气影响语言风格和案例选择
- 语言决定输出文档的主要语言

#### 1.3 内容要求配置（教案模块选择）

##### 可选模块清单
提供多选复选框，用户可自由组合：

| 模块名称 | 描述 | 建议场景 |
|---------|------|---------|
| 学情分析 | 分析学生基础、特点、需求 | 新班级、差异化教学 |
| 教学目标 | 知识、能力、情感目标 | 所有教案必选 |
| 课程重点 | 核心知识点和关键概念 | 所有教案必选 |
| 课程难点 | 学生易错点和理解障碍 | 复杂主题 |
| 教学准备 | 教具、材料、环境准备 | 实验、实践课 |
| 教学过程 | 详细的教学步骤和活动 | 所有教案必选 |
| 作业与评价 | 课后练习和评估方式 | 常规教学 |
| 教学反思 | 课后总结和改进建议 | 公开课、研讨课 |
| 思政元素 | 德育和价值观引导 | 高校课程 |
| 教学价值分析 | 课程意义和育人价值 | 课程设计、教改 |

##### 默认推荐组合
系统根据学段和学科自动推荐模块组合：
- 基础教育：教学目标 + 课程重难点 + 教学过程 + 作业评价
- 高等教育：教学目标 + 课程重难点 + 教学过程 + 思政元素 + 教学反思
- 公开课：全部模块

#### 1.4 教案模板区

##### 模板类型
提供5种Word教案样式模板：

| 模板编号 | 模板名称 | 特点 | 适用场景 |
|---------|---------|------|---------|
| 模板一 | 标准教案 | 传统格式，层次分明 | 常规教学 |
| 模板二 | 课程表形式 | 表格化，时间轴清晰 | 长课时、多活动 |
| 模板三 | 图文结构 | 图文并茂，视觉友好 | 实验、演示课 |
| 模板四 | 双栏排版 | 教学内容与备注分栏 | 详细教案 |
| 模板五 | 简洁型 | 核心要素，简明扼要 | 经验教师、快速备课 |

##### 模板预览
- 用户选择模板时，显示模板样式缩略图
- 点击可查看模板完整预览
- 显示模板的主要特征和适用说明

##### 模板选择交互
- 单选卡片式布局
- 选中状态高亮显示
- 支持模板对比查看

#### 1.5 参考教案上传

##### 上传功能
- 支持上传已有教案文件
- 接受格式：.docx、.pdf、.txt
- 文件大小限制：不超过10MB

##### AI学习机制
- 系统解析上传的参考教案
- 提取写作风格、结构特点、语言习惯
- 在生成新教案时模仿参考风格

##### 使用说明
- 用户可上传个人历史教案
- AI将学习并延续用户的写作风格
- 保持教学文档的一致性

#### 1.6 AI生成教学大纲预览

##### 实时生成机制
当用户完成参数配置后，AI立即在页面下方生成教学大纲预览，无需等待点击生成按钮。

##### 大纲内容结构
显示的大纲包括：
- 教学目标（知识、能力、情感）
- 教学重点（列表形式）
- 教学难点（列表形式）
- 教学过程（分阶段展示）
  - 导入环节（时长、活动）
  - 讲授新课（时长、步骤、案例）
  - 巩固练习（时长、题目）
  - 总结反馈（时长、方式）
- 案例说明
- 实验/活动说明（如适用）

##### 编辑功能
- 大纲内容可直接在线编辑
- 支持添加、删除、调整顺序
- 修改后实时保存

##### 视觉设计
- 采用卡片式布局，清晰分块
- 关键信息高亮显示
- 时间轴或流程图可视化（如适用）

#### 1.7 生成出口（操作按钮区）

##### 三个核心按钮

**按钮一：添加到教案列表**
- 功能：保存当前教案到个人教案库
- 触发后：跳转到教案管理页面
- 状态：教案标记为"草稿"

**按钮二：生成Word教案**
- 功能：根据所选模板导出Word文档
- 触发后：
  1. 显示生成进度
  2. 应用所选模板样式
  3. 下载.docx文件
- 文件命名：教案标题_日期_模板名.docx

**按钮三：一键生成PPT**
- 功能：进入PPT大纲生成流程（见下节详细设计）
- 触发后：显示PPT大纲预览弹窗
- 与当前直接导出PPT不同，增加中间预览确认环节

##### 按钮布局设计
- 三个按钮横向排列
- 确保不被其他元素遮挡
- 固定在页面底部或内容区下方
- 移动端采用堆叠布局

##### 防遮挡设计要点
- 按钮区域采用固定定位或相对定位
- 确保z-index层级高于其他元素
- 背景添加明显对比色
- 必要时添加阴影或边框增强可见性

### 二、PPT大纲生成与AI PPT流程重构

#### 2.1 当前问题
- 用户点击"导出PPT"直接生成文件，缺少预览环节
- 无法在生成前调整PPT结构和内容
- 不符合主流教学平台的交互习惯

#### 2.2 新流程设计

##### 阶段一：生成PPT大纲
**触发方式**：
- 在教案创建页面点击"一键生成PPT"按钮
- 在教案管理页面选择教案后点击"生成PPT大纲"

**AI分析过程**：
1. 解析教案内容
2. 识别关键章节和知识点
3. 生成10-30张幻灯片大纲
4. 每张幻灯片包含：标题、内容要点、备注

**大纲结构示例**（见TeachingPreviewMode.jsx中的pptOutline数据结构）：
- 第1张：封面（标题、副标题）
- 第2张：目录
- 第3-N张：内容页（每个知识点/章节）
- 倒数第2张：课堂小结
- 最后1张：课后作业

**幻灯片类型分类**：
- cover：封面页
- content：内容讲解页
- interactive：互动讨论页
- summary：总结页
- homework：作业布置页

##### 阶段二：大纲预览与编辑
**展示方式**：
- 弹窗或新页面展示大纲
- 卡片式列表，每张幻灯片一个卡片
- 显示幻灯片编号、类型、标题、内容要点

**编辑功能**：
- 修改幻灯片标题
- 编辑内容要点
- 添加/删除幻灯片
- 调整幻灯片顺序（拖拽）
- 修改幻灯片类型
- 编辑教学备注

**视觉元素**：
- 幻灯片编号显示在左侧圆形徽章中
- 类型用彩色标签标识
- 内容要点用列表展示
- 教学备注用黄色提示框显示

**参考实现**：TeachingPreviewMode.jsx 第543-680行的PPT大纲弹窗

##### 阶段三：确认并生成AI PPT
**操作按钮**：
- "导出PPT"按钮：位于大纲预览弹窗右上角
- "关闭"按钮：取消生成，返回

**生成过程**：
1. 用户点击"导出PPT"
2. AI根据大纲生成PPT文件
3. 显示生成进度条
4. 完成后自动下载.pptx文件

**生成规则**：
- 每张幻灯片根据类型应用对应模板
- 内容要点转换为文本框或列表
- 公式自动转换为公式对象
- 图片占位符预留空间
- 备注作为演讲者备注

**PPT页数规范**：
- 45分钟课程：推荐15-20张
- 90分钟课程：推荐25-35张
- 用户可在大纲阶段调整

#### 2.3 UI改进要点

##### 按钮文案调整
- 原按钮文案："导出PPT" / "一键生成PPT"
- 新按钮文案：
  - 第一步："生成PPT大纲"
  - 第二步（大纲弹窗内）："导出PPT" / "一键生成AI PPT"

##### 流程提示
- 在按钮附近添加文字说明："先生成大纲，再生成PPT"
- 大纲预览页顶部显示："基于当前文档内容智能生成，您可以根据实际需要进行调整"

##### 防误操作
- 如果教案内容为空或过短，禁用"生成PPT大纲"按钮
- 提示用户先完善教案内容

### 三、知识点与目录联动选择

#### 3.1 当前问题
- 知识点和大纲目录概念混淆
- 选择目录后，无法批量选中下属知识点
- 缺少树形结构展示

#### 3.2 概念区分

##### 大纲/目录
- 定义：课程的组织结构，章节层级关系
- 特点：层次化、结构化、抽象概念
- 示例：第一章 → 1.1节 → 1.1.1小节

##### 知识点
- 定义：具体的教学内容单元，需要学生掌握的知识
- 特点：具体、可评估、有难度等级
- 示例："德布罗意波长公式"、"光的波粒二象性"

##### 关系
- 一个目录节点可以包含多个知识点
- 一个知识点可以属于多个目录节点
- 大纲是容器，知识点是内容

#### 3.3 数据结构设计

##### 目录树结构
```
目录节点 {
  id: 唯一标识
  title: 节点标题
  level: 层级（章/节/小节）
  children: 子节点数组
  knowledgePoints: 关联的知识点ID数组
  parentId: 父节点ID
}
```

##### 知识点结构（保持现有结构，增加字段）
```
知识点 {
  id: 唯一标识
  name: 知识点名称
  description: 描述
  difficulty: 难度级别
  category: 分类
  tags: 标签
  catalogIds: 所属目录节点ID数组（新增）
}
```

#### 3.4 选择交互设计

##### 展示方式
- 左侧：树形目录结构（可折叠展开）
- 右侧：知识点列表（带搜索过滤）

##### 联动逻辑
**点击目录节点时**：
1. 自动选中该节点关联的所有知识点
2. 递归选中所有子节点关联的知识点
3. 右侧知识点列表高亮已选项

**点击知识点时**：
1. 选中该知识点
2. 左侧目录树自动展开并高亮相关节点

**取消选择时**：
- 取消目录节点：取消该节点及子节点的所有知识点
- 取消知识点：如果该节点下所有知识点都被取消，目录节点也取消高亮

##### 视觉反馈
- 目录节点选中：背景色变化 + 左侧竖条高亮
- 知识点选中：卡片边框高亮 + 右上角勾选图标
- 半选状态：目录节点部分知识点被选中时，显示半选图标

##### 快捷操作
- "全选当前章节"按钮
- "清除所有选择"按钮
- "只保留已选"按钮（过滤显示）

#### 3.5 数据绑定配置

##### 配置文件设计
创建知识点与目录的映射关系配置文件（JSON格式）：

```
{
  catalogTree: [目录树数据],
  knowledgePoints: [知识点数据],
  bindings: [
    {
      catalogId: "目录ID",
      knowledgePointIds: ["知识点ID1", "知识点ID2"]
    }
  ]
}
```

##### 维护方式
- 教师后台提供可视化配置界面
- 拖拽知识点到目录节点完成绑定
- 支持批量导入Excel配置

### 四、教案模板管理系统

#### 4.1 模板定义

##### 模板本质
教案模板是一个文档样式配置文件，包含：
- 版式结构（页面布局、边距、字体）
- 内容占位符（标题、目标、过程等模块的位置）
- 样式定义（标题样式、正文样式、列表样式）
- 格式规范（编号规则、缩进、间距）

##### 模板类型
- Word模板（.dotx格式）
- PPT模板（.potx格式）
- 自定义JSON配置模板（用于系统内部生成）

#### 4.2 模板管理功能

##### 管理入口
- 位置：教师系统 → 教学资源管理 → 教案模板管理
- 路径：/teacher/lesson-plan-templates

##### 核心功能

**模板列表展示**：
- 卡片式展示所有模板
- 显示模板名称、类型、预览图、创建时间
- 支持搜索和筛选（按类型、按创建者）

**上传模板**：
- 点击"上传模板"按钮
- 选择.dotx或.potx文件
- 填写模板名称、描述、标签
- 上传预览图（可选）
- 保存到模板库

**模板预览**：
- 点击模板卡片查看完整预览
- 显示模板的主要特征和适用说明
- 支持在线预览（转换为PDF或图片）

**编辑模板信息**：
- 修改模板名称、描述、标签
- 更换预览图
- 设置是否为默认模板

**删除模板**：
- 删除前确认提示
- 检查是否有教案正在使用该模板
- 删除后无法恢复（可考虑回收站机制）

**设为默认**：
- 将某个模板设为默认模板
- 创建教案时默认选中

**模板导出**：
- 下载模板文件到本地
- 可用于分享或备份

#### 4.3 模板应用流程

##### 在教案创建时选择模板
1. 用户在"教案模板区"看到所有可用模板
2. 点击选择模板
3. 预览模板样式
4. 确认选择

##### 生成Word时应用模板
1. 系统读取所选模板文件
2. 将教案内容填充到模板占位符
3. 应用模板的样式和格式
4. 生成最终Word文档

##### 模板变量设计
模板文件中使用占位符标记：
- `{{title}}`：教案标题
- `{{courseName}}`：课程名称
- `{{author}}`：作者
- `{{objectives}}`：教学目标
- `{{process}}`：教学过程
- 等等

#### 4.4 系统内置模板

##### 默认提供5个模板
- 模板一：标准教案
- 模板二：课程表形式
- 模板三：图文结构
- 模板四：双栏排版
- 模板五：简洁型

##### 内置模板特性
- 不可删除，但可隐藏
- 可复制后修改
- 提供模板源文件下载

#### 4.5 数据存储

##### 模板文件存储
- 文件存储位置：服务器文件系统或云存储
- 数据库记录模板元信息

##### 模板元信息表结构
| 字段名 | 类型 | 说明 |
|--------|------|------|
| id | String | 模板唯一标识 |
| name | String | 模板名称 |
| type | String | 模板类型（word/ppt） |
| description | String | 模板描述 |
| previewImage | String | 预览图URL |
| filePath | String | 模板文件路径 |
| isDefault | Boolean | 是否默认模板 |
| isBuiltIn | Boolean | 是否内置模板 |
| creatorId | String | 创建者ID |
| tags | Array | 标签 |
| createdAt | DateTime | 创建时间 |
| updatedAt | DateTime | 更新时间 |

## 页面布局结构

### 教案创建页面整体结构

#### 页面分区
```
┌─────────────────────────────────────────────────┐
│  顶部导航栏                                      │
├─────────────────────────────────────────────────┤
│  创建方式入口（5个大卡片）                       │
│  [标题] [文本] [章节] [知识点] [大纲]            │
├─────────────────────────────────────────────────┤
│  基本参数配置区                                  │
│  学段 | 学科 | 语气 | 语言                       │
├─────────────────────────────────────────────────┤
│  内容要求（教案模块多选）                        │
│  □ 学情分析  □ 教学目标  □ 课程重点  ...        │
├─────────────────────────────────────────────────┤
│  教案模板选择区                                  │
│  [模板1] [模板2] [模板3] [模板4] [模板5]         │
├─────────────────────────────────────────────────┤
│  参考教案上传区                                  │
│  [上传文件] 已上传：xxx.docx                     │
├─────────────────────────────────────────────────┤
│  AI生成教学大纲预览（实时更新）                  │
│  ┌─ 教学目标 ─────────────────────────┐         │
│  │ ...                                  │         │
│  ├─ 教学重点 ─────────────────────────┤         │
│  │ ...                                  │         │
│  ├─ 教学过程 ─────────────────────────┤         │
│  │ ...                                  │         │
│  └─────────────────────────────────────┘         │
├─────────────────────────────────────────────────┤
│  操作按钮区（固定底部，防遮挡）                  │
│  [添加到教案列表] [生成Word教案] [生成PPT大纲]   │
└─────────────────────────────────────────────────┘
```

#### 响应式布局
- 桌面端：宽度最大1200px，居中显示
- 平板端：宽度适应屏幕，卡片2列排列
- 移动端：单列布局，按钮堆叠

### PPT大纲预览弹窗布局

#### 弹窗结构
```
┌─────────────────────────────────────────────┐
│  弹窗头部                                    │
│  [图标] AI生成的PPT大纲 (共10张)  [导出] [X] │
├─────────────────────────────────────────────┤
│  大纲内容滚动区                              │
│  ┌────────────────────────────────────────┐ │
│  │ [1] 封面页                              │ │
│  │     标题：波粒二象性                    │ │
│  │     备注：...                           │ │
│  ├────────────────────────────────────────┤ │
│  │ [2] 目录页                              │ │
│  │     内容：...                           │ │
│  ├────────────────────────────────────────┤ │
│  │ [3] 内容页                              │ │
│  │     标题：光的波粒二象性                │ │
│  │     要点：...                           │ │
│  │     备注：...                           │ │
│  └────────────────────────────────────────┘ │
├─────────────────────────────────────────────┤
│  弹窗底部                                    │
│  提示：此大纲可编辑调整    [关闭]           │
└─────────────────────────────────────────────┘
```

#### 卡片内部结构
每张幻灯片卡片包含：
- 左侧：幻灯片编号（圆形徽章）
- 右侧：
  - 标题 + 类型标签
  - 副标题（如有）
  - 内容要点列表
  - 公式（如有）
  - 图片占位符标签（如有）
  - 教学备注（黄色提示框）

### 模板管理页面布局

#### 页面结构
```
┌─────────────────────────────────────────────┐
│  页面头部                                    │
│  教案模板管理          [上传模板]            │
├─────────────────────────────────────────────┤
│  搜索和筛选栏                                │
│  [搜索框] [类型筛选] [排序]                  │
├─────────────────────────────────────────────┤
│  模板列表（卡片网格）                        │
│  ┌───────┐ ┌───────┐ ┌───────┐ ┌───────┐   │
│  │模板1  │ │模板2  │ │模板3  │ │模板4  │   │
│  │[预览] │ │[预览] │ │[预览] │ │[预览] │   │
│  │标准   │ │课表   │ │图文   │ │双栏   │   │
│  │[编辑] │ │[编辑] │ │[编辑] │ │[编辑] │   │
│  │[删除] │ │[删除] │ │[删除] │ │[删除] │   │
│  └───────┘ └───────┘ └───────┘ └───────┘   │
│  ┌───────┐                                  │
│  │模板5  │                                  │
│  │[预览] │                                  │
│  │简洁   │                                  │
│  │[编辑] │                                  │
│  │[删除] │                                  │
│  └───────┘                                  │
└─────────────────────────────────────────────┘
```

## 数据流设计

### 教案创建数据流

#### 输入数据
```
创建配置 {
  创建方式: "标题" | "文本" | "章节" | "知识点" | "大纲"
  输入内容: {
    // 根据创建方式不同而不同
    标题创建: { courseName: string }
    文本创建: { textContent: string }
    章节创建: { chapterNumber: string, chapterName: string }
    知识点创建: { knowledgePointIds: string[] }
    大纲创建: { outlineTree: OutlineNode[] }
  }
  基本参数: {
    学段: string
    学科: string
    语气: string
    语言: string
  }
  内容要求: {
    模块列表: string[] // 选中的模块
  }
  模板配置: {
    模板ID: string
  }
  参考教案: {
    文件URL: string | null
  }
}
```

#### AI处理流程
```
用户输入 → 参数验证 → AI分析 → 生成大纲 → 用户编辑 → 确认 → 生成完整教案 → 应用模板 → 输出文档
```

#### 输出数据
```
教案对象 {
  id: string
  标题: string
  课程名称: string
  元信息: {
    作者: string
    创建时间: DateTime
    学段: string
    学科: string
    语气: string
    语言: string
  }
  内容: {
    学情分析: string (可选)
    教学目标: string
    课程重点: string
    课程难点: string
    教学准备: string (可选)
    教学过程: string
    作业与评价: string (可选)
    教学反思: string (可选)
    思政元素: string (可选)
    教学价值分析: string (可选)
  }
  模板ID: string
  状态: "草稿" | "已发布" | "已归档"
  版本: number
}
```

### PPT大纲生成数据流

#### 输入
- 教案完整内容

#### AI分析
1. 解析教案结构
2. 提取关键章节和知识点
3. 识别重点、难点
4. 生成幻灯片大纲

#### 大纲数据结构
```
PPT大纲 {
  幻灯片列表: [
    {
      编号: number
      类型: "cover" | "content" | "interactive" | "summary" | "homework"
      标题: string
      副标题: string (可选)
      内容要点: string[]
      公式: string (可选)
      图片: string[] (可选)
      教学备注: string
    }
  ]
  总页数: number
  课程时长: number
  建议演讲时间: number (分钟)
}
```

#### 用户编辑
- 修改标题、内容、备注
- 添加/删除幻灯片
- 调整顺序

#### 输出
- 生成PPT文件（.pptx格式）

### 知识点与目录关联数据流

#### 目录树数据
```
目录树 {
  节点列表: [
    {
      id: string
      标题: string
      层级: number
      父节点ID: string | null
      子节点ID列表: string[]
      关联知识点ID列表: string[]
    }
  ]
}
```

#### 选择操作数据流
1. 用户点击目录节点
2. 系统查找该节点及所有子节点的关联知识点ID
3. 更新知识点选择状态
4. 界面刷新显示

#### 反向关联
1. 用户选择知识点
2. 系统查找包含该知识点的所有目录节点
3. 高亮相关目录节点

## 交互设计细节

### 教案创建流程交互

#### 步骤导航
- 采用步骤条或进度指示器
- 显示当前步骤和已完成步骤
- 支持点击跳转到已完成步骤

#### 表单验证
- 实时验证：用户输入时即时反馈错误
- 提交验证：点击生成按钮前的最终检查
- 错误提示：红色边框 + 错误文字说明

#### 加载状态
- AI生成教案时显示加载动画
- 显示进度百分比或提示文字："AI正在生成教案，预计需要10秒..."
- 生成完成后淡入动画展示结果

#### 编辑自由度
- 所有AI生成的内容都可编辑
- 提供"重新生成"按钮
- 提供"恢复默认"按钮

### PPT大纲交互

#### 大纲编辑操作
- 点击标题进入编辑模式
- 点击内容要点可编辑
- 点击备注可编辑
- 编辑时高亮显示编辑区域

#### 幻灯片管理
- 拖拽幻灯片卡片调整顺序
- 点击"删除"图标删除幻灯片
- 点击"添加"按钮在当前位置插入新幻灯片
- 批量操作：选择多张幻灯片，统一删除或移动

#### 导出确认
- 点击"导出PPT"后显示确认对话框
- 显示PPT总页数和预估生成时间
- 用户确认后开始生成

### 模板管理交互

#### 上传模板
- 拖拽上传或点击选择文件
- 上传进度条显示
- 上传成功后自动跳转到模板详情页

#### 模板预览
- 点击模板卡片弹出预览弹窗
- 支持翻页查看多页预览
- 支持缩放预览图

#### 模板选择
- 单选模式，选中后其他模板取消选中
- 选中状态：边框加粗 + 背景色变化 + 勾选图标

## 技术实现要点

### UI层级管理

#### 防遮挡策略
- 操作按钮区使用固定定位（sticky或fixed）
- 设置合理的z-index层级
- 确保按钮区域背景不透明
- 添加阴影增强视觉分离

#### 弹窗管理
- 使用Modal组件管理弹窗
- 弹窗背景遮罩（backdrop）
- 点击遮罩关闭弹窗（可配置）
- 弹窗内容滚动，外部固定

### AI生成逻辑

#### 实时大纲生成
- 使用防抖（debounce）减少频繁调用
- 用户停止输入500ms后触发生成
- 后台异步生成，不阻塞UI

#### 模板变量替换
- 使用模板引擎（如Handlebars、Mustache）
- 定义标准占位符语法
- 支持条件渲染和循环渲染

### 文件处理

#### Word文档生成
- 使用docx.js或类似库
- 读取.dotx模板文件
- 替换占位符
- 应用样式
- 生成并下载.docx文件

#### PPT文档生成
- 使用pptxgen.js或类似库
- 根据大纲数据创建幻灯片
- 应用PPT模板样式
- 添加文本、图片、公式
- 生成并下载.pptx文件

#### 文件上传与存储
- 前端：使用FormData上传文件
- 后端：接收文件，保存到服务器或云存储
- 返回文件URL或ID

### 数据持久化

#### 本地存储
- 使用localStorage保存草稿
- 定期自动保存（每30秒）
- 页面关闭前提示保存

#### 服务器存储
- 保存完整教案到数据库
- 保存模板文件到文件系统
- 保存用户配置和偏好设置

## 验收标准

### 功能验收

#### 教案创建功能
- [ ] 5种创建方式全部可用
- [ ] 基本参数配置正确影响生成结果
- [ ] 内容模块选择正确控制输出内容
- [ ] 模板选择正确应用到Word导出
- [ ] 参考教案上传功能正常
- [ ] AI大纲实时生成并可编辑
- [ ] 三个操作按钮全部可见可用，无遮挡

#### PPT大纲功能
- [ ] 点击"生成PPT大纲"正确弹出大纲预览
- [ ] 大纲内容结构完整，包含10-30张幻灯片
- [ ] 大纲可编辑（标题、内容、备注）
- [ ] 幻灯片可添加、删除、排序
- [ ] 点击"导出PPT"生成正确的.pptx文件
- [ ] PPT文件内容与大纲一致

#### 知识点选择功能
- [ ] 目录树正确展示
- [ ] 点击目录节点，自动选中所有关联知识点
- [ ] 点击知识点，目录树高亮相关节点
- [ ] 取消选择正确联动
- [ ] 搜索和筛选功能正常

#### 模板管理功能
- [ ] 模板列表正确展示
- [ ] 模板上传功能正常
- [ ] 模板预览功能正常
- [ ] 模板编辑、删除功能正常
- [ ] 默认模板设置功能正常
- [ ] 内置模板不可删除

### UI验收

#### 布局验收
- [ ] 页面布局清晰，分区明确
- [ ] 按钮不被其他元素遮挡
- [ ] 弹窗居中显示，遮罩正常
- [ ] 响应式布局在不同屏幕尺寸下正常

#### 交互验收
- [ ] 表单验证实时反馈
- [ ] 加载状态显示清晰
- [ ] 编辑操作流畅无卡顿
- [ ] 拖拽排序功能正常
- [ ] 弹窗打开关闭动画流畅

#### 视觉验收
- [ ] 选中状态明显
- [ ] 高亮效果清晰
- [ ] 颜色对比度符合规范
- [ ] 字体大小易读

### 性能验收
- [ ] AI生成响应时间 < 10秒
- [ ] 页面加载时间 < 3秒
- [ ] 文件上传成功率 > 95%
- [ ] Word/PPT导出成功率 > 95%

## 实施计划

### 阶段一：UI修复和基础重构（优先级最高）
**目标**：修复当前bug，恢复基本功能

**任务**：
1. 修复导出按钮遮挡问题
2. 调整按钮区布局，确保可见性
3. 测试导出功能恢复正常

**预计时间**：1天

### 阶段二：PPT大纲功能开发
**目标**：实现"生成大纲 → 预览编辑 → 导出PPT"流程

**任务**：
1. 开发PPT大纲生成逻辑
2. 实现大纲预览弹窗UI
3. 实现大纲编辑功能
4. 集成PPT导出功能
5. 测试完整流程

**预计时间**：3天

### 阶段三：多创建方式支持
**目标**：支持5种教案创建方式

**任务**：
1. 设计创建方式入口UI
2. 实现标题创建逻辑
3. 实现文本创建逻辑
4. 实现章节创建逻辑
5. 实现大纲创建逻辑（重点）
6. 测试各创建方式

**预计时间**：4天

### 阶段四：参数配置系统
**目标**：完善AI生成参数配置

**任务**：
1. 实现学段、学科、语气、语言选择UI
2. 实现教案模块多选UI
3. 开发参考教案上传功能
4. 集成参数到AI生成逻辑
5. 测试参数影响生成结果

**预计时间**：3天

### 阶段五：知识点与目录联动
**目标**：实现目录树和知识点的关联选择

**任务**：
1. 设计目录树数据结构
2. 开发目录树UI组件
3. 实现目录与知识点关联逻辑
4. 实现联动选择功能
5. 配置初始关联数据
6. 测试联动效果

**预计时间**：3天

### 阶段六：模板管理系统
**目标**：建立教案模板管理功能

**任务**：
1. 设计模板管理页面UI
2. 实现模板上传功能
3. 实现模板列表展示
4. 实现模板预览、编辑、删除
5. 实现模板应用到Word导出
6. 配置5个内置模板
7. 测试模板管理功能

**预计时间**：4天

### 阶段七：集成测试和优化
**目标**：整体测试和性能优化

**任务**：
1. 全流程功能测试
2. 性能测试和优化
3. UI细节优化
4. Bug修复
5. 文档完善

**预计时间**：2天

**总计时间**：约20个工作日
